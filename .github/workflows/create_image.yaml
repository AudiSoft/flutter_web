# Copyright Â© 2021 - AudiSoft Consulting (https://www.audisoft.com/).

# Creates an Ubuntu-based Docker image with web-enabled Flutter already installed.
name: Create Flutter Web Docker Image

# Run this workflow every time a new commit is pushed.
on: push

jobs:
  create_image:
    name: Create image
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Dockefile
        uses: actions/checkout@v2
      - name: Login to GitHub Container Regitry with Personal Access Token (PAT)
        run: echo ${{ secrets.CONTAINER_REGISTRY_TOKEN }} | docker login ghcr.io -u $GITHUB_ACTOR --password-stdin
      - name: Download base image from hub.docker.com
        run: docker pull cirrusci/flutter:latest
      - name: Build new image
        run: docker build . --tag ghcr.io/audisoft/flutter:$GITHUB_SHA --cache-from ghcr.io/audisoft/flutter:latest
      - name: Publish new image to ghcr.io
        run: docker push ghcr.io/audisoft/flutter:$GITHUB_SHA
